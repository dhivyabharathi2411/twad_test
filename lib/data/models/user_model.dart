import '../../domain/entities/user.dart';

/// User data model for API responses and local storage
class UserModel extends User {
  const UserModel({
    required super.id,
    required super.name,
    required super.contactno,
    super.address,
    required super.emailid,
    super.districtId,
    super.blockId,
    super.villageId,
    super.habitationId,
    super.pincode,
    super.whatsappno,
    super.districtName,
    super.organisationName,
    super.zoneName,
    super.zoneWardName,
    super.municipalityName,
    super.municipalityWardName,
    super.townPanchayatName,
    super.townPanchayatWardName,
    super.zoneWardId,
    super.zoneId,
    super.municipalityId,
    super.corporationId,
    super.municipalityWardId,
    super.townPanchayatId,
    super.townPanchayatWardId,
    super.divisionId,
    super.lastLoginAt,
    super.isActive,
  });

  /// Create UserModel from JSON (API response)
  factory UserModel.fromJson(Map<String, dynamic> json) {
    return UserModel(
      id: json['id']?.toString() ?? '',
      name: json['name'] ?? '',
      contactno: json['contactno'] ?? '',
      address: json['address'],
      emailid: json['emailid'] ?? '',
      districtId: json['district_id']?.toString(),
      blockId: json['block_id']?.toString(),
      villageId: json['village_id']?.toString(),
      habitationId: json['habitation_id']?.toString(),
      pincode: json['pincode']?.toString(),
      whatsappno: json['whatsappno']?.toString(),
      districtName: json['district_name'] ?? '',
      organisationName: json['organisation_name'] ?? '',
      zoneName: json['zone_name'] ?? '',
      zoneWardName: json['zone_ward_name'] ?? '',
      municipalityName: json['municipality_name'] ?? '',
      municipalityWardName: json['municipality_ward_name'] ?? '',
      townPanchayatName: json['town_panchayat_name'] ?? '',
      townPanchayatWardName: json['town_panchayat_ward_name'] ?? '',
      zoneId: json['zone_id']?.toString(),
      zoneWardId: json['zone_ward_id']?.toString(),
      municipalityId: json['municipality_id']?.toString(),
      municipalityWardId: json['municipality_ward_id']?.toString(),
      townPanchayatId: json['town_panchayat_id']?.toString(),
      townPanchayatWardId: json['town_panchayat_ward_id']?.toString(),
      divisionId: json['division_id']?.toString(),
      lastLoginAt: json['last_login_at'] != null 
          ? DateTime.tryParse(json['last_login_at']) 
          : null,
      isActive: json['is_active'] ?? json['active'] ?? true,
    );
  }

  /// Convert to JSON for API requests
  Map<String, dynamic> toJson() {
    return {
      'id': id,
      'name': name,
      'contactno': contactno,
      'address': address,
      'emailid': emailid,
      'district_id': districtId,
      'block_id': blockId,
      'village_id': villageId,
      'habitation_id': habitationId,
      'pincode': pincode,
      'whatsappno': whatsappno,
      'district_name': districtName,
      'organisation_name': organisationName,
      'zone_name': zoneName,
      'zone_ward_name': zoneWardName,
      'municipality_name': municipalityName,
      'municipality_ward_name': municipalityWardName,
      'town_panchayat_name': townPanchayatName,
      'town_panchayat_ward_name': townPanchayatWardName,
      'zone_id': zoneId,
      'zone_ward_id': zoneWardId,
      'municipality_id': municipalityId,
      'municipality_ward_id': municipalityWardId,
      'town_panchayat_id': townPanchayatId,
      'town_panchayat_ward_id': townPanchayatWardId,
      'division_id': divisionId,
      'last_login_at': lastLoginAt?.toIso8601String(),
      'is_active': isActive,
    };
  }

  /// Convert to local storage JSON
  Map<String, dynamic> toLocalJson() {
    return {
      'id': id,
      'name': name,
      'contactno': contactno,
      'address': address,
      'emailid': emailid,
      'district_id': districtId,
      'block_id': blockId,
      'village_id': villageId,
      'habitation_id': habitationId,
      'pincode': pincode,
      'whatsappno': whatsappno,
      'district_name': districtName,
      'organisation_name': organisationName,
      'zone_name': zoneName,
      'zone_ward_name': zoneWardName,
      'municipality_name': municipalityName,
      'municipality_ward_name': municipalityWardName,
      'town_panchayat_name': townPanchayatName,
      'town_panchayat_ward_name': townPanchayatWardName,
      'zone_ward_id': zoneWardId,
      'zone_id': zoneId,
      'municipality_id': municipalityId,
      'municipality_ward_id': municipalityWardId,
      'town_panchayat_id': townPanchayatId,
      'town_panchayat_ward_id': townPanchayatWardId,
      'division_id': divisionId,
      'last_login_at': lastLoginAt?.millisecondsSinceEpoch,
      'is_active': isActive,
    };
  }

  /// Create from local storage JSON
  factory UserModel.fromLocalJson(Map<String, dynamic> json) {
    return UserModel(
      id: json['id'],
      name: json['name'] ?? '',
      contactno: json['contactno'] ?? '',
      address: json['address'],
      emailid: json['emailid'] ?? '',
      districtId: json['district_id'],
      blockId: json['block_id'],
      villageId: json['village_id'],
      habitationId: json['habitation_id'],
      pincode: json['pincode'],
      whatsappno: json['whatsappno'],
      districtName: json['district_name'],
      organisationName: json['organisation_name'],
      zoneName: json['zone_name'],
      zoneWardName: json['zone_ward_name'],
      municipalityName: json['municipality_name'],
      municipalityWardName: json['municipality_ward_name'],
      townPanchayatName: json['town_panchayat_name'],
      townPanchayatWardName: json['town_panchayat_ward_name'],
      zoneWardId: json['zone_ward_id'],
      zoneId: json['zone_id'],
      municipalityId: json['municipality_id'],
      municipalityWardId: json['municipality_ward_id'],
      townPanchayatId: json['town_panchayat_id'],
      townPanchayatWardId: json['town_panchayat_ward_id'],
      divisionId: json['division_id'],
      lastLoginAt: json['last_login_at'] != null 
          ? DateTime.fromMillisecondsSinceEpoch(json['last_login_at'])
          : null,
      isActive: json['is_active'] ?? true,
    );
  }

  /// Convert to domain entity
  User toEntity() {
    return User(
      id: id,
      name: name,
      contactno: contactno,
      address: address,
      emailid: emailid,
      districtId: districtId,
      blockId: blockId,
      villageId: villageId,
      habitationId: habitationId,
      pincode: pincode,
      whatsappno: whatsappno,
      districtName: districtName,
      organisationName: organisationName,
      zoneName: zoneName,
      zoneWardName: zoneWardName,
      municipalityName: municipalityName,
      municipalityWardName: municipalityWardName,
      townPanchayatName: townPanchayatName,
      townPanchayatWardName: townPanchayatWardName,
      zoneWardId: zoneWardId,
      zoneId: zoneId,
      municipalityId: municipalityId,
      municipalityWardId: municipalityWardId,
      townPanchayatId: townPanchayatId,
      townPanchayatWardId: townPanchayatWardId,
      divisionId: divisionId,
      lastLoginAt: lastLoginAt,
      isActive: isActive,
    );
  }

  /// Create from domain entity
  factory UserModel.fromEntity(User user) {
    return UserModel(
      id: user.id,
      name: user.name,
      contactno: user.contactno,
      address: user.address,
      emailid: user.emailid,
      districtId: user.districtId,
      blockId: user.blockId,
      villageId: user.villageId,
      habitationId: user.habitationId,
      pincode: user.pincode,
      whatsappno: user.whatsappno,
      districtName: user.districtName,
      organisationName: user.organisationName,
      zoneName: user.zoneName,
      zoneWardName: user.zoneWardName,
      municipalityName: user.municipalityName,
      municipalityWardName: user.municipalityWardName,
      townPanchayatName: user.townPanchayatName,
      townPanchayatWardName: user.townPanchayatWardName,
      zoneWardId: user.zoneWardId,
      zoneId: user.zoneId,
      municipalityId: user.municipalityId,
      municipalityWardId: user.municipalityWardId,
      townPanchayatId: user.townPanchayatId,
      townPanchayatWardId: user.townPanchayatWardId,
      divisionId: user.divisionId,
      lastLoginAt: user.lastLoginAt,
      isActive: user.isActive,
    );
  }

  /// Create a copy with updated fields
  @override
  UserModel copyWith({
    String? id,
    String? name,
    String? contactno,
    String? address,
    String? emailid,
    String? districtId,
    String? blockId,
    String? villageId,
    String? habitationId,
    String? pincode,
    String? whatsappno,
    String? districtName,
    String? organisationName,
    String? zoneName,
    String? zoneWardName,
    String? municipalityName,
    String? municipalityWardName,
    String? townPanchayatName,
    String? townPanchayatWardName,
    String? zoneWardId,
    String? zoneId,
    String? municipalityId,
    String? municipalityWardId,
    String? corporationId,
    String? townPanchayatId,
    String? townPanchayatWardId,
    String? divisionId,
    DateTime? lastLoginAt,
    bool? isActive,
  }) {
    return UserModel(
      id: id ?? this.id,
      name: name ?? this.name,
      contactno: contactno ?? this.contactno,
      address: address ?? this.address,
      emailid: emailid ?? this.emailid,
      districtId: districtId ?? this.districtId,
      blockId: blockId ?? this.blockId,
      villageId: villageId ?? this.villageId,
      habitationId: habitationId ?? this.habitationId,
      pincode: pincode ?? this.pincode,
      whatsappno: whatsappno ?? this.whatsappno,
      districtName: districtName ?? this.districtName,
      organisationName: organisationName ?? this.organisationName,
      zoneName: zoneName ?? this.zoneName,
      zoneWardName: zoneWardName ?? this.zoneWardName,
      municipalityName: municipalityName ?? this.municipalityName,
      municipalityWardName: municipalityWardName ?? this.municipalityWardName,
      townPanchayatName: townPanchayatName ?? this.townPanchayatName,
      townPanchayatWardName: townPanchayatWardName ?? this.townPanchayatWardName,
      zoneWardId: zoneWardId ?? this.zoneWardId,
      zoneId: zoneId ?? this.zoneId,
      municipalityId: municipalityId ?? this.municipalityId,
      municipalityWardId: municipalityWardId ?? this.municipalityWardId,
      townPanchayatId: townPanchayatId ?? this.townPanchayatId,
      townPanchayatWardId: townPanchayatWardId ?? this.townPanchayatWardId,
      divisionId: divisionId ?? this.divisionId,
      lastLoginAt: lastLoginAt ?? this.lastLoginAt,
      isActive: isActive ?? this.isActive,
    );
  }
}
